"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types")),reactRouterDom=require("react-router-dom"),isUndefined=function(e){return void 0===e},isNull=function(e){return null===e},isFunction=function(e){return"function"==typeof e},isString=function(e){return"string"==typeof e},isExist=function(e){return!(isUndefined(e)||isNull(e))},get=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=arguments[2];t=isString(t)?t.split("."):t;for(var n=void 0,o=e,c=0;c<t.length;c++){var a=t[c];if(!isExist(o))break;o=o[a]}return c===t.length&&(n=o),isUndefined(n)?r:n},run=function(e){for(var t=arguments.length,r=Array(2<t?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];o=isString(o)?o.split("."):o;var c=get(e,o),a=get(e,o.slice(0,-1));return isFunction(c)?c.call.apply(c,[a].concat(r)):c},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},__new__lifecycles=16.3<=Number(get(run(React__default,"version.match",/^\d*\.\d*/),[0])),getDerivedStateFromProps=function(e,t){var r=e.match,n=e.when,o=void 0===n?"forward":n;if(get(r,"__CacheRoute__computedMatch__null")&&(r=null),!t.cached&&r)return{cached:!0,matched:!0};if(t.matched&&!r){var c=get(e,"history.action"),a=!1;switch(o){case"always":break;case"back":["PUSH","REPLACE"].includes(c)&&(a=!0);break;case"forward":default:"POP"===c&&(a=!0)}if(a)return{cached:!1,matched:!1}}return{matched:!!r}},CacheComponent=function(e){function a(){var e,t,r;classCallCheck(this,a);for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];return(t=r=possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).state=getDerivedStateFromProps(r.props,{cached:!1,matched:!1}),r.componentWillReceiveProps=__new__lifecycles?void 0:function(e){r.setState(getDerivedStateFromProps(e,r.state))},r.cacheLifecycles={__listener:{},didCache:function(e){r.cacheLifecycles.__listener.didCache=e},didRecover:function(e){r.cacheLifecycles.__listener.didRecover=e}},possibleConstructorReturn(r,t)}return inherits(a,e),createClass(a,[{key:"render",value:function(){return this.state.cached?React__default.createElement("div",{className:this.props.className,style:this.state.matched?{}:{display:"none"}},run(this.props,"children",this.cacheLifecycles)):null}},{key:"componentDidUpdate",value:function(e,t){if(t.cached&&this.state.cached)return!0===t.matched&&!1===this.state.matched?run(this,"cacheLifecycles.__listener.didCache"):!1===t.matched&&!0===this.state.matched?run(this,"cacheLifecycles.__listener.didRecover"):void 0}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.matched||t.matched}}]),a}(React.Component);CacheComponent.propsTypes={history:PropTypes.object.isRequired,match:PropTypes.object.isRequired,children:PropTypes.func.isRequired,className:PropTypes.string,when:PropTypes.oneOf(["forward","back","always"])},CacheComponent.defaultProps={when:"forward"},CacheComponent.getDerivedStateFromProps=__new__lifecycles?getDerivedStateFromProps:void 0;var Updatable=function(e){function a(){var e,t,r;classCallCheck(this,a);for(var n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];return(t=r=possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).render=function(){return r.props.render()},possibleConstructorReturn(r,t)}return inherits(a,e),createClass(a,[{key:"shouldComponentUpdate",value:function(e){return isExist(e.match)&&!0!==get(e,"match.__CacheRoute__computedMatch__null")}}]),a}(React.Component);Updatable.propsTypes={render:PropTypes.func.isRequired,match:PropTypes.object.isRequired};var isEmptyChildren=function(e){return 0===React__default.Children.count(e)},CacheRoute=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"render",value:function(){var e=this.props,r=e.children,n=e.render,o=e.component,c=e.className,a=e.when,t=objectWithoutProperties(e,["children","render","component","className","when"]);return!React__default.isValidElement(r)&&isEmptyChildren(r)||(n=function(){return r}),React__default.createElement(reactRouterDom.Route,_extends({},t,{children:function(t){return React__default.createElement(CacheComponent,_extends({},t,{when:a,className:c}),function(e){return React__default.createElement(Updatable,{match:t.match,render:function(){return Object.assign(t,{cacheLifecycles:e}),o?React__default.createElement(o,t):run(n||r,void 0,t)}})})}}))}}]),t}(React.Component);CacheRoute.componentName="CacheRoute",CacheRoute.propTypes={component:PropTypes.func,render:PropTypes.func,children:PropTypes.oneOfType([PropTypes.func,PropTypes.node]),className:PropTypes.string,when:PropTypes.oneOf(["forward","back","always"])},CacheRoute.defaultProps={when:"forward"};var CacheSwitch=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"render",value:function(){var l=this.context.router.route,e=this.props.children,p=this.props.location||l.location,h=!1;return React__default.Children.map(e,function(e){if(!React__default.isValidElement(e))return null;var t=e.props,r=t.path,n=t.exact,o=t.strict,c=t.sensitive,a=t.from,i=r||a,s=h?null:reactRouterDom.matchPath(p.pathname,{path:i,exact:n,strict:o,sensitive:c},l.match),u=void 0;switch(get(e,"type.componentName")){case"CacheRoute":u=React__default.cloneElement(e,{location:p,computedMatch:isNull(s)?{__CacheRoute__computedMatch__null:!0}:s});break;default:u=s&&!h?React__default.cloneElement(e,{location:p,computedMatch:s}):null}return h||(h=!!s),u})}}]),t}(reactRouterDom.Switch);CacheSwitch.contextTypes={router:PropTypes.shape({route:PropTypes.object.isRequired}).isRequired},CacheSwitch.propTypes={children:PropTypes.node,location:PropTypes.object},exports.default=CacheRoute,exports.CacheRoute=CacheRoute,exports.CacheSwitch=CacheSwitch;
